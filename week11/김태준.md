### 20장 리다이렉션과 부하 균형
 - 리다이렉션 기술은 보통 메시지가 프락시, 캐시, 서버 팜의 특정 웹 서버 중 어디에서 끝나는지 판별하기 위해 사용한다.
 - 리다이렉션 기술은 클라이언트의 메시지를 명시적으로 요청하지 않은 곳으로 보낼 수 있다.

#### 20.1 왜 리다이렉트인가 ?
- HTTP 에플리케이션은 언제나 다음 세 가지를 원한다.
  - 1. 신뢰할 수 있는 HTTP 트랜잭션의 수행
  - 2. 지연 최소화
  - 3. 네트워크 대역폭 절약
- 따라서, 위 조건에 더 적합한 곳으로 리다이렉트 처리한다. ( 서버가 여러대라면 1, 2, 3 조건이 더 적합한 곳으로 )

#### 20.2 리다이렉트 할 곳
 - 위에서 살펴본 1, 2, 3 조건이 충족되는 최적의 장소 ( 서버, 프락시, 캐시, 게이트웨이..등등)

#### 20.3. 리다이렉션 프로토콜의 개요
 - 리다이렉션의 목표는 HTTP 메시지를 가용한 웹 서버로 가급적 빨리 보내는 것이다.

#### 20.4 일반적인 리다이렉션 방법
##### 20.4.1 HTTP 리다이렉션
 - 웹 서버들은 다른 곳에 요청을 보내보라고 말해주는 짧은 리다이렉트 메시지를 클라이언트에게 돌려줄 수 있다. ( 301, 302 response Code ) -> 몇몇 웹 사이트는 HTTP 리다이렉션을 이용해 간단히 부하를 분산한다. ( P.527 그림 20-1)
 - HTTP 리다이렉션은 서버로 향하는 요청의 방향(클라이언트가 요청하는 목적지 주소)은 변경할 수 있지만 다음과 같은 단점을 가지고 있다.
   - 1. 어떤 서버로 리다이렉트할지 결정하는 과정에서 많은 작업을 처리해야 할 수 있다. 
   - 2. 페이지에 접근할 때마다 두번의 왕복이 필요하기 때문에 ( 클라 -> 서버,  서버 -> 클라,  클라 -> 리다이렉트 서버, 리다이렉트 서버 -> 클라 )
   - 3. 만약, 리다이렉트 서버가 다운되면, 사이트도 다운된다.
- 이러한 단점들 때문에 HTTP 리다이렉션은 보통 몇몇 다른 리다이렉션 기법과 함께 조합하여 사용한다.

##### 20.4.2 DNS 리다이렉션
 - www.joes-hardware.com에 해당하는 서버를 찾기 위해서는 해당 도메인을 ip로 변환하는 작업이 필요하다. ( dns 서버를 통해 )  DNS는 하나의 도메인에 여러 아이피 주소가 결부되는 것을 허용한다. -> 따라서, 도메인으로 요청을 했을때 어떤 아이피의 서버를 return 해줄지 결정하는 방법이 필요하다.

##### DNS 라운드 로빈
 - 서버에 대한 클라이언트의 상대적인 위치나 서버의 현재 부하상태를 고려하지 않고 순차적으로 요청을 배분한다.

##### 다중 주소와 라운드 로빈 주소 순환
 - 대부분의 DNS 클라이언트는 다중 주소 집합의 첫 번째 주소를 사용한다.  부하 균형을 위해, 대부분의 DNS 서버는 룩업이 끝났을 때마다 주소를 순환시킨다. ( P.529 예제 20-2 )

##### 부하 균형을 위한 DNS 라운드 로빈
 - 대부분의 DNS 클라이언트는 그냥 첫 번째 주소를 사용하기 때문에, DNS 순환은 서버들 간의 부하 균형을 유지해준다. 만약, DNS 순환이 발생하지 않는다면 대부분의 클라이언트가 첫 번째 목록의 서버를 선택할 것이고, 해당 서버로 요청이 몰릴 것이다. (P.531 그림 20-3 참고 )

##### DNS 캐싱의 효과
 - DNS 룩업의 결과는 캐시로 남아서 재사용 될 수 있다. -> 이러한 이유로 DNS 라운드 로빈은 일반적으로 하나의 클라이언트로 인한 부하를 제대로 분산하지 못한다.
 - 그러나, 비록 DNS가 단일 클라이언트의 트랜잭션을 서버의 복제들에게 나눠주지 않더라도, 여러 클라이언트 들의 부하 총량을 분산하는데는 적합하다.

##### 다른 DNS 기반 리다이렉션 알고리즘
 - 몇몇 향상된 DNS 서버는 주소의 순서를 결정하기 위해 다른 기법들을 사용한다.
   - 1. 부하 균형 알고리즘 ( 부하가 가장 적은 곳으로 요청을 전달 )
   - 2. 근접 라우팅 알고리즘 ( 가까운 곳으로 보낸다. )
   - 3. 결함 마시킹 알고리즘 ( 장애가 없는 서버로 보낸다. )

##### 20.4.3 임의 캐스트 어드레싱
 - 여러 지리적으로 흩어진 웹 서버들은 정확히 같은 아이피 주소를 갖고 클라이언트의 요청을 클라이언트에서 가장 가까운 서버로 보내주기 위해 백본 라우터의 "최단거리" 라우팅 능력에 의지한다. ( 뭔소린지 모르겠음.. )

##### 20.4.4 아이피 맥 포워딩
 - 레이어-2 장비(스위치, 허브)의 역할은 들어오는 특정 맥주소의 패킷을 받아서 나가는 특정 맥주소로 포워딩 하는 것이다.
 - MAC 주소 포워딩은 점 대 점으로만 가능하기 때문에, 서버나 프락시는 스위치와 한 홉 거리에 위치해야 한다.

##### 20.4.5 아이피 주소 포워딩
 - 